import{r as j,F as d,j as e,S as B,y as P,B as b,m as ne,M as R,T as h,s as O,z as ie,A as oe}from"./index-B1irlVr5.js";import{u as re,c as de}from"./salaryStore-tJ1QZuQs.js";import{u as ce}from"./financeStore-Cx6ve21G.js";import{S as G}from"./index-CouCZRz8.js";import{F as me}from"./Table-WxZSygbk.js";import{D as n}from"./index-vBZKdVps.js";import{T as g}from"./index-DtubzoSF.js";const v={fixed:"固定月薪",hourly:"计时工资",piece:"计件工资",commission:"销售提成",mixed:"混合制"};function ge(){const{payrolls:u,employees:N,salaryStructures:z,salaryFormulas:w,updatePayroll:E,addPayroll:W}=re(),{addRecord:H}=ce(),[c,K]=j.useState("2024-01"),[q,$]=j.useState(!1),[l,J]=j.useState(null),[Q,S]=j.useState(!1),[I]=d.useForm(),x=u.filter(t=>t.month===c),U=t=>{J(t),$(!0)},V=t=>{const a=u.find(i=>i.id===t);if(a){const i=new Date().toISOString().split("T")[0];E(t,{status:"paid",paidDate:i}),H({id:`salary-${t}-${Date.now()}`,type:"expense",amount:a.netSalary,category:"人力成本",description:`${a.month} 工资发放 - ${a.employeeName}`,date:i,createdAt:i}),O.success("工资已发放，已自动生成支出记录")}},X=()=>{I.resetFields(),S(!0)},Y=()=>{I.validateFields().then(t=>{const a=u.filter(s=>s.month===c).map(s=>s.employeeId);let i=0;N.filter(s=>s.status==="active"&&!a.includes(s.id)).forEach(s=>{const r=z.find(p=>p.employeeId===s.id),o=w.find(p=>p.id===s.salaryFormulaId);if(!r)return;let y=r.baseSalary+r.positionAllowance,k=0,L=0,_=0,T="";const te=(o==null?void 0:o.type)||"fixed";if(o){const p={baseSalaryOverride:r.baseSalary,hoursWorked:t[`hours_${s.id}`]||176,overtimeHours:t[`overtime_${s.id}`]||0,piecesCompleted:t[`pieces_${s.id}`]||0,salesAmount:t[`sales_${s.id}`]||0,performanceLevel:t[`performance_${s.id}`]||"B"},m=de(o,p);y=m.grossSalary,T=m.description,k=m.details.绩效奖金||0,L=m.details.加班费||m.details.加班工时||0,_=m.details.销售提成||0}const M=Math.round(r.baseSalary*((o==null?void 0:o.socialInsuranceRate)||10)/100),C=Math.round(r.baseSalary*((o==null?void 0:o.housingFundRate)||8)/100),D=M+C,ae=y-D-5e3,A=Math.max(0,Math.round(ae*.1)),se=Math.round(y-D-A),le={id:Date.now().toString()+s.id,employeeId:s.id,employeeName:s.name,department:s.department,month:c,formulaType:te,baseSalary:r.baseSalary,positionAllowance:r.positionAllowance,performanceBonus:k,overtime:L,commission:_,hoursWorked:t[`hours_${s.id}`],piecesCompleted:t[`pieces_${s.id}`],salesAmount:t[`sales_${s.id}`],deductions:0,socialInsurance:M,housingFund:C,tax:A,grossSalary:y,netSalary:se,status:"pending",calculationDetails:T};W(le),i++}),S(!1),O.success(`已生成 ${i} 条工资单`)})},Z=x.reduce((t,a)=>t+a.netSalary,0),F=x.filter(t=>t.status==="paid").length,ee=[{title:"员工姓名",dataIndex:"employeeName",key:"employeeName",width:90},{title:"部门",dataIndex:"department",key:"department",width:80},{title:"工资类型",dataIndex:"formulaType",key:"formulaType",width:90,render:t=>e.jsx(h,{color:"blue",children:v[t]||t})},{title:"基本工资",dataIndex:"baseSalary",key:"baseSalary",width:100,render:t=>`¥${t.toLocaleString()}`},{title:"绩效/提成",key:"bonus",width:100,render:(t,a)=>`¥${((a.performanceBonus||0)+(a.commission||0)).toLocaleString()}`},{title:"扣款",key:"deduct",width:90,render:(t,a)=>`¥${(a.socialInsurance+a.housingFund+a.tax).toLocaleString()}`},{title:"实发工资",dataIndex:"netSalary",key:"netSalary",width:100,render:t=>e.jsxs("span",{className:"font-bold text-green-600",children:["¥",t.toLocaleString()]})},{title:"状态",dataIndex:"status",key:"status",width:80,render:t=>e.jsx(h,{color:t==="paid"?"green":"orange",children:t==="paid"?"已发放":"待发放"})},{title:"操作",key:"action",width:140,render:(t,a)=>e.jsxs(B,{children:[e.jsx(b,{icon:e.jsx(ie,{}),size:"small",onClick:()=>U(a),children:"详情"}),a.status==="pending"&&e.jsx(P,{action:"update",children:e.jsx(b,{icon:e.jsx(oe,{}),size:"small",type:"primary",onClick:()=>V(a.id),children:"发放"})})]})}],f=N.filter(t=>{const a=u.filter(i=>i.month===c).map(i=>i.employeeId);return t.status==="active"&&!a.includes(t.id)});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"工资单管理"}),e.jsxs(B,{children:[e.jsx(G,{value:c,onChange:K,style:{width:150},options:[{label:"2024年1月",value:"2024-01"},{label:"2024年2月",value:"2024-02"},{label:"2024年3月",value:"2024-03"},{label:"2024年11月",value:"2024-11"},{label:"2024年12月",value:"2024-12"}]}),e.jsx(P,{action:"create",children:e.jsxs(b,{onClick:X,disabled:f.length===0,children:["生成工资单 (",f.length,")"]})}),e.jsx(b,{icon:e.jsx(ne,{}),children:"导出"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded",children:[e.jsx("div",{className:"text-gray-500",children:"工资单数量"}),e.jsx("div",{className:"text-2xl font-bold",children:x.length})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded",children:[e.jsx("div",{className:"text-gray-500",children:"已发放 / 待发放"}),e.jsxs("div",{className:"text-2xl font-bold",children:[F," / ",x.length-F]})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded",children:[e.jsx("div",{className:"text-gray-500",children:"应发总额"}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["¥",Z.toLocaleString()]})]})]}),e.jsx(me,{columns:ee,dataSource:x,rowKey:"id"}),e.jsx(R,{title:"工资条详情",open:q,onCancel:()=>$(!1),footer:null,width:600,children:l&&e.jsxs(n,{bordered:!0,column:2,children:[e.jsx(n.Item,{label:"员工姓名",children:l.employeeName}),e.jsx(n.Item,{label:"部门",children:l.department}),e.jsx(n.Item,{label:"工资月份",children:l.month}),e.jsx(n.Item,{label:"工资类型",children:e.jsx(h,{color:"blue",children:v[l.formulaType]})}),e.jsx(n.Item,{label:"状态",children:e.jsx(h,{color:l.status==="paid"?"green":"orange",children:l.status==="paid"?"已发放":"待发放"})}),e.jsx(n.Item,{label:"计算说明",children:l.calculationDetails||"-"}),e.jsxs(n.Item,{label:"基本工资",children:["¥",l.baseSalary.toLocaleString()]}),e.jsxs(n.Item,{label:"岗位津贴",children:["¥",l.positionAllowance.toLocaleString()]}),e.jsxs(n.Item,{label:"绩效奖金",children:["¥",l.performanceBonus.toLocaleString()]}),e.jsxs(n.Item,{label:"提成/加班",children:["¥",((l.commission||0)+l.overtime).toLocaleString()]}),e.jsxs(n.Item,{label:"社保扣款",children:["-¥",l.socialInsurance.toLocaleString()]}),e.jsxs(n.Item,{label:"公积金扣款",children:["-¥",l.housingFund.toLocaleString()]}),e.jsxs(n.Item,{label:"个人所得税",children:["-¥",l.tax.toLocaleString()]}),e.jsxs(n.Item,{label:"其他扣款",children:["-¥",l.deductions.toLocaleString()]}),e.jsx(n.Item,{label:"实发工资",span:2,children:e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["¥",l.netSalary.toLocaleString()]})})]})}),e.jsxs(R,{title:`生成${c}工资单`,open:Q,onOk:Y,onCancel:()=>S(!1),width:700,okText:"生成",children:[e.jsx("p",{className:"mb-4 text-gray-500",children:"请为以下员工填写工资计算参数："}),e.jsx(d,{form:I,layout:"vertical",children:f.map(t=>{const a=w.find(i=>i.id===t.salaryFormulaId);return e.jsxs("div",{className:"border rounded p-3 mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"font-bold",children:[t.name," - ",t.department]}),e.jsx(h,{color:"blue",children:a?v[a.type]:"未设置公式"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[((a==null?void 0:a.type)==="hourly"||(a==null?void 0:a.type)==="mixed")&&e.jsxs(e.Fragment,{children:[e.jsx(d.Item,{name:`hours_${t.id}`,label:"工作小时",initialValue:176,children:e.jsx(g,{className:"w-full",min:0})}),e.jsx(d.Item,{name:`overtime_${t.id}`,label:"加班小时",initialValue:0,children:e.jsx(g,{className:"w-full",min:0})})]}),(a==null?void 0:a.type)==="piece"&&e.jsx(d.Item,{name:`pieces_${t.id}`,label:"完成件数",initialValue:0,children:e.jsx(g,{className:"w-full",min:0})}),(a==null?void 0:a.type)==="commission"&&e.jsx(d.Item,{name:`sales_${t.id}`,label:"销售额",initialValue:0,children:e.jsx(g,{className:"w-full",min:0,prefix:"¥"})}),((a==null?void 0:a.type)==="fixed"||(a==null?void 0:a.type)==="mixed")&&e.jsx(d.Item,{name:`performance_${t.id}`,label:"绩效等级",initialValue:"B",children:e.jsx(G,{options:[{label:"A级 (优秀)",value:"A"},{label:"B级 (良好)",value:"B"},{label:"C级 (合格)",value:"C"},{label:"D级 (待改进)",value:"D"}]})})]})]},t.id)})})]})]})}export{ge as default};
