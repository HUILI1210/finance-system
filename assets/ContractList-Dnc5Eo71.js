import{r as j,I as L,_,G as P,H as W,F as r,j as e,B as y,f as K,R as g,C as l,a as u,T as M,M as A,g as h,s as v,z as V,i as G,k as J}from"./index-Cc0-Jhr3.js";import{d as x}from"./dayjs.min-BVNUWGIa.js";import{S as I}from"./index-BAFu33Px.js";import{F as Y}from"./Table-CWDNoC-e.js";import{S as Q}from"./index-BlAgGAzq.js";import{D as w}from"./index-D5WML2O3.js";import{T as U}from"./index-BFN91nfk.js";import{D as n}from"./index-BPzBcVnd.js";import{P as X}from"./index-4_QrhmQT.js";var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"},ee=function(c,o){return j.createElement(L,_({},c,{ref:o,icon:Z}))},z=j.forwardRef(ee);const te=[{id:"1",contractNo:"HT202401001",title:"软件开发服务合同",type:"sales",partyA:"本公司",partyB:"客户A公司",amount:5e5,signDate:"2024-01-10",startDate:"2024-01-15",endDate:"2024-12-31",status:"active",description:"为客户A提供软件开发服务"},{id:"2",contractNo:"HT202401002",title:"办公设备采购合同",type:"purchase",partyA:"本公司",partyB:"供应商A",amount:8e4,signDate:"2024-01-05",startDate:"2024-01-10",endDate:"2024-02-28",status:"active",description:"采购办公电脑及设备"},{id:"3",contractNo:"HT202401003",title:"年度咨询服务合同",type:"service",partyA:"本公司",partyB:"客户B公司",amount:2e5,signDate:"2023-12-20",startDate:"2024-01-01",endDate:"2024-12-31",status:"active",description:"年度管理咨询服务"},{id:"4",contractNo:"HT202312001",title:"员工劳动合同-张三",type:"labor",partyA:"本公司",partyB:"张三",amount:24e4,signDate:"2022-03-15",startDate:"2022-03-15",endDate:"2025-03-14",status:"active",description:"技术部高级工程师"},{id:"5",contractNo:"HT202312002",title:"临时用工协议",type:"labor",partyA:"本公司",partyB:"临时员工",amount:15e3,signDate:"2023-11-01",startDate:"2023-11-01",endDate:"2024-01-31",status:"expired",description:"项目临时支援"}],ae=P()(W(i=>({contracts:te,addContract:c=>i(o=>({contracts:[...o.contracts,c]})),updateContract:(c,o)=>i(m=>({contracts:m.contracts.map(p=>p.id===c?{...p,...o}:p)})),deleteContract:c=>i(o=>({contracts:o.contracts.filter(m=>m.id!==c)}))}),{name:"contract-storage"})),F=[{label:"销售合同",value:"sales"},{label:"采购合同",value:"purchase"},{label:"服务合同",value:"service"},{label:"劳动合同",value:"labor"}];function ue(){const{contracts:i,addContract:c,updateContract:o,deleteContract:m}=ae(),[p,b]=j.useState(!1),[q,C]=j.useState(!1),[s,N]=j.useState(null),[f]=r.useForm(),S=i.filter(t=>t.status==="active"),O=S.reduce((t,a)=>t+a.amount,0),D=i.filter(t=>{if(t.status!=="active")return!1;const a=x(t.endDate).diff(x(),"day");return a>=0&&a<=30}),k=t=>{N(t||null),t?f.setFieldsValue({...t,signDate:x(t.signDate),startDate:x(t.startDate),endDate:x(t.endDate)}):f.resetFields(),b(!0)},R=t=>{N(t),C(!0)},H=()=>{f.validateFields().then(t=>{const a={...t,signDate:t.signDate.format("YYYY-MM-DD"),startDate:t.startDate.format("YYYY-MM-DD"),endDate:t.endDate.format("YYYY-MM-DD")};s?(o(s.id,a),v.success("更新成功")):(c({...a,id:Date.now().toString(),status:"active"}),v.success("添加成功")),b(!1)})},$=t=>{m(t),v.success("删除成功")},T=t=>{const a=F.find(d=>d.value===t);return(a==null?void 0:a.label)||t},B=t=>{const d={draft:{color:"default",text:"草稿"},active:{color:"green",text:"生效中"},expired:{color:"orange",text:"已过期"},terminated:{color:"red",text:"已终止"}}[t]||{color:"default",text:t};return e.jsx(M,{color:d.color,children:d.text})},E=[{title:"合同编号",dataIndex:"contractNo",key:"contractNo",width:130},{title:"合同名称",dataIndex:"title",key:"title"},{title:"类型",dataIndex:"type",key:"type",width:100,render:t=>T(t)},{title:"乙方",dataIndex:"partyB",key:"partyB",width:120},{title:"金额",dataIndex:"amount",key:"amount",width:120,render:t=>`¥${t.toLocaleString()}`},{title:"开始日期",dataIndex:"startDate",key:"startDate",width:110},{title:"结束日期",dataIndex:"endDate",key:"endDate",width:110},{title:"状态",dataIndex:"status",key:"status",width:90,render:t=>B(t)},{title:"操作",key:"action",width:180,render:(t,a)=>e.jsxs(e.Fragment,{children:[e.jsx(y,{icon:e.jsx(V,{}),size:"small",onClick:()=>R(a),children:"详情"}),e.jsx(y,{icon:e.jsx(G,{}),size:"small",onClick:()=>k(a),className:"ml-1",children:"编辑"}),e.jsx(X,{title:"确定删除?",onConfirm:()=>$(a.id),children:e.jsx(y,{icon:e.jsx(J,{}),size:"small",danger:!0,className:"ml-1",children:"删除"})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"合同管理"}),e.jsx(y,{type:"primary",icon:e.jsx(K,{}),onClick:()=>k(),children:"新增合同"})]}),e.jsxs(g,{gutter:16,className:"mb-4",children:[e.jsx(l,{span:6,children:e.jsx(u,{children:e.jsx(I,{title:"合同总数",value:i.length})})}),e.jsx(l,{span:6,children:e.jsx(u,{children:e.jsx(I,{title:"生效中",value:S.length,valueStyle:{color:"#3f8600"}})})}),e.jsx(l,{span:6,children:e.jsx(u,{children:e.jsx(I,{title:"合同总金额",value:O,prefix:"¥",precision:2})})}),e.jsx(l,{span:6,children:e.jsx(u,{children:e.jsx(I,{title:"即将到期(30天内)",value:D.length,prefix:e.jsx(z,{}),valueStyle:{color:D.length>0?"#cf1322":"#3f8600"}})})})]}),D.length>0&&e.jsx(u,{title:e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"text-orange-500 mr-2"}),"即将到期合同"]}),className:"mb-4",size:"small",children:e.jsx(Y,{size:"small",pagination:!1,dataSource:D,rowKey:"id",columns:[{title:"合同编号",dataIndex:"contractNo"},{title:"合同名称",dataIndex:"title"},{title:"乙方",dataIndex:"partyB"},{title:"到期日",dataIndex:"endDate"},{title:"剩余天数",render:(t,a)=>{const d=x(a.endDate).diff(x(),"day");return e.jsxs(M,{color:d<7?"red":"orange",children:[d,"天"]})}}]})}),e.jsx(u,{children:e.jsx(Y,{columns:E,dataSource:i,rowKey:"id",scroll:{x:1200}})}),e.jsx(A,{title:s?"编辑合同":"新增合同",open:p,onOk:H,onCancel:()=>b(!1),width:700,children:e.jsxs(r,{form:f,layout:"vertical",children:[e.jsxs(g,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"contractNo",label:"合同编号",rules:[{required:!0}],children:e.jsx(h,{})})}),e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"type",label:"合同类型",rules:[{required:!0}],children:e.jsx(Q,{options:F})})})]}),e.jsx(r.Item,{name:"title",label:"合同名称",rules:[{required:!0}],children:e.jsx(h,{})}),e.jsxs(g,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"partyA",label:"甲方",rules:[{required:!0}],children:e.jsx(h,{})})}),e.jsx(l,{span:12,children:e.jsx(r.Item,{name:"partyB",label:"乙方",rules:[{required:!0}],children:e.jsx(h,{})})})]}),e.jsxs(g,{gutter:16,children:[e.jsx(l,{span:8,children:e.jsx(r.Item,{name:"signDate",label:"签订日期",rules:[{required:!0}],children:e.jsx(w,{className:"w-full"})})}),e.jsx(l,{span:8,children:e.jsx(r.Item,{name:"startDate",label:"开始日期",rules:[{required:!0}],children:e.jsx(w,{className:"w-full"})})}),e.jsx(l,{span:8,children:e.jsx(r.Item,{name:"endDate",label:"结束日期",rules:[{required:!0}],children:e.jsx(w,{className:"w-full"})})})]}),e.jsx(r.Item,{name:"amount",label:"合同金额",rules:[{required:!0}],children:e.jsx(U,{className:"w-full",prefix:"¥",precision:2})}),e.jsx(r.Item,{name:"description",label:"备注",children:e.jsx(h.TextArea,{rows:2})})]})}),e.jsx(A,{title:"合同详情",open:q,onCancel:()=>C(!1),footer:null,width:600,children:s&&e.jsxs(n,{bordered:!0,column:2,children:[e.jsx(n.Item,{label:"合同编号",children:s.contractNo}),e.jsx(n.Item,{label:"合同类型",children:T(s.type)}),e.jsx(n.Item,{label:"合同名称",span:2,children:s.title}),e.jsx(n.Item,{label:"甲方",children:s.partyA}),e.jsx(n.Item,{label:"乙方",children:s.partyB}),e.jsxs(n.Item,{label:"合同金额",children:["¥",s.amount.toLocaleString()]}),e.jsx(n.Item,{label:"状态",children:B(s.status)}),e.jsx(n.Item,{label:"签订日期",children:s.signDate}),e.jsx(n.Item,{label:"生效日期",children:s.startDate}),e.jsx(n.Item,{label:"到期日期",span:2,children:s.endDate}),e.jsx(n.Item,{label:"备注",span:2,children:s.description})]})})]})}export{ue as default};
