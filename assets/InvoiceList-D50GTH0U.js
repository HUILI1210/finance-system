import{r as I,F as n,j as e,R as j,C as i,a as r,J as b,B as h,f as g,x as Y,M as $,g as u,s as S,T as O}from"./index-B1irlVr5.js";import{u as B}from"./invoiceStore-Bi-2iBNi.js";import{S as a}from"./index-DTABTL4s.js";import{F as N}from"./Table-WxZSygbk.js";import{T as E}from"./index-DtubzoSF.js";import{D as K}from"./index-B_DoBQcZ.js";import"./index-CouCZRz8.js";import"./dayjs.min-CuWnGRVX.js";function U(){const{invoices:f,addInvoice:k,updateInvoice:T}=B(),[A,x]=I.useState(!1),[p,C]=I.useState("output"),[m]=n.useForm(),l=f.filter(t=>t.type==="output"),o=f.filter(t=>t.type==="input"),D=l.reduce((t,s)=>t+s.totalAmount,0),c=l.reduce((t,s)=>t+s.taxAmount,0),M=o.reduce((t,s)=>t+s.totalAmount,0),d=o.reduce((t,s)=>t+s.taxAmount,0),v=t=>{C(t),m.resetFields(),x(!0)},w=()=>{m.validateFields().then(t=>{const s=Math.round(t.amount*.13);k({...t,id:Date.now().toString(),type:p,taxAmount:s,totalAmount:t.amount+s,invoiceDate:t.invoiceDate.format("YYYY-MM-DD"),status:"pending"}),S.success("添加成功"),x(!1)})},F=t=>{T(t,{status:"verified"}),S.success("认证成功")},q=t=>({pending:"orange",verified:"green",cancelled:"red"})[t]||"default",L=t=>({pending:"待认证",verified:"已认证",cancelled:"已作废"})[t]||t,y=[{title:"发票号码",dataIndex:"invoiceNo",key:"invoiceNo"},{title:"发票代码",dataIndex:"invoiceCode",key:"invoiceCode"},{title:"对方单位",dataIndex:"counterparty",key:"counterparty"},{title:"金额",dataIndex:"amount",key:"amount",render:t=>`¥${t.toLocaleString()}`},{title:"税额",dataIndex:"taxAmount",key:"taxAmount",render:t=>`¥${t.toLocaleString()}`},{title:"价税合计",dataIndex:"totalAmount",key:"totalAmount",render:t=>e.jsxs("span",{className:"font-bold",children:["¥",t.toLocaleString()]})},{title:"开票日期",dataIndex:"invoiceDate",key:"invoiceDate"},{title:"状态",dataIndex:"status",key:"status",render:t=>e.jsx(O,{color:q(t),children:L(t)})},{title:"操作",key:"action",render:(t,s)=>s.status==="pending"&&s.type==="input"&&e.jsx(h,{size:"small",type:"primary",onClick:()=>F(s.id),children:"认证"})}],R=[{key:"output",label:"销项发票",children:e.jsxs("div",{children:[e.jsxs(j,{gutter:16,className:"mb-4",children:[e.jsx(i,{span:8,children:e.jsx(r,{children:e.jsx(a,{title:"销项发票数",value:l.length,prefix:e.jsx(b,{})})})}),e.jsx(i,{span:8,children:e.jsx(r,{children:e.jsx(a,{title:"销项金额",value:D,prefix:"¥",precision:2})})}),e.jsx(i,{span:8,children:e.jsx(r,{children:e.jsx(a,{title:"销项税额",value:c,prefix:"¥",precision:2,valueStyle:{color:"#cf1322"}})})})]}),e.jsx("div",{className:"mb-4",children:e.jsx(h,{type:"primary",icon:e.jsx(g,{}),onClick:()=>v("output"),children:"开具发票"})}),e.jsx(N,{columns:y,dataSource:l,rowKey:"id"})]})},{key:"input",label:"进项发票",children:e.jsxs("div",{children:[e.jsxs(j,{gutter:16,className:"mb-4",children:[e.jsx(i,{span:8,children:e.jsx(r,{children:e.jsx(a,{title:"进项发票数",value:o.length,prefix:e.jsx(b,{})})})}),e.jsx(i,{span:8,children:e.jsx(r,{children:e.jsx(a,{title:"进项金额",value:M,prefix:"¥",precision:2})})}),e.jsx(i,{span:8,children:e.jsx(r,{children:e.jsx(a,{title:"可抵扣税额",value:d,prefix:"¥",precision:2,valueStyle:{color:"#3f8600"}})})})]}),e.jsx("div",{className:"mb-4",children:e.jsx(h,{type:"primary",icon:e.jsx(g,{}),onClick:()=>v("input"),children:"录入发票"})}),e.jsx(N,{columns:y,dataSource:o,rowKey:"id"})]})}];return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-xl font-bold",children:"发票管理"})}),e.jsxs(r,{className:"mb-4",children:[e.jsxs(j,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(a,{title:"本期销项税额",value:c,prefix:"¥",precision:2,valueStyle:{color:"#cf1322"}})}),e.jsx(i,{span:12,children:e.jsx(a,{title:"本期进项税额",value:d,prefix:"¥",precision:2,valueStyle:{color:"#3f8600"}})})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("span",{className:"text-gray-500",children:"应缴增值税："}),e.jsxs("span",{className:`text-xl font-bold ${c-d>0?"text-red-600":"text-green-600"}`,children:["¥",(c-d).toLocaleString()]})]})]}),e.jsx(Y,{items:R}),e.jsx($,{title:p==="output"?"开具发票":"录入发票",open:A,onOk:w,onCancel:()=>x(!1),children:e.jsxs(n,{form:m,layout:"vertical",children:[e.jsx(n.Item,{name:"invoiceNo",label:"发票号码",rules:[{required:!0}],children:e.jsx(u,{})}),e.jsx(n.Item,{name:"invoiceCode",label:"发票代码",rules:[{required:!0}],children:e.jsx(u,{})}),e.jsx(n.Item,{name:"counterparty",label:p==="output"?"购方单位":"销方单位",rules:[{required:!0}],children:e.jsx(u,{})}),e.jsx(n.Item,{name:"amount",label:"金额（不含税）",rules:[{required:!0}],children:e.jsx(E,{className:"w-full",prefix:"¥",precision:2})}),e.jsx(n.Item,{name:"invoiceDate",label:"开票日期",rules:[{required:!0}],children:e.jsx(K,{className:"w-full"})}),e.jsx(n.Item,{name:"description",label:"摘要",children:e.jsx(u,{})})]})})]})}export{U as default};
