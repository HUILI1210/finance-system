import{r as n,I as A,_ as L,aI as M,j as e,S as p,B as j,k as D,R as P,C as r,a as o,g as F,h as V,T as g,s as Y}from"./index-B1irlVr5.js";import{d as x}from"./dayjs.min-CuWnGRVX.js";import{P as _}from"./index-CsXvx_N-.js";import{S as i}from"./index-DTABTL4s.js";import{S as f}from"./index-CouCZRz8.js";import{D as B}from"./index-B_DoBQcZ.js";import{F as E}from"./Table-WxZSygbk.js";var O={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},$=function(c,s){return n.createElement(A,L({},c,{ref:s,icon:O}))},z=n.forwardRef($);function W(){const{logs:l,clearLogs:c}=M(),[s,v]=n.useState(""),[d,w]=n.useState(),[u,y]=n.useState(),S=l.filter(t=>{const a=t.description.includes(s)||t.userName.includes(s),T=!d||t.action===d,N=!u||t.module===u;return a&&T&&N}).sort((t,a)=>new Date(a.timestamp).getTime()-new Date(t.timestamp).getTime()),m=t=>({create:{color:"green",text:"新增"},update:{color:"blue",text:"修改"},delete:{color:"red",text:"删除"},login:{color:"cyan",text:"登录"},logout:{color:"orange",text:"登出"}})[t]||{color:"default",text:t},h=t=>({admin:{color:"red",text:"管理员"},accountant:{color:"blue",text:"财务"},viewer:{color:"green",text:"访客"}})[t],b=[...new Set(l.map(t=>t.module))],R=l.filter(t=>x(t.timestamp).isSame(x(),"day")).length,C=l.filter(t=>["create","update","delete"].includes(t.action)).length,I=[{title:"时间",dataIndex:"timestamp",key:"timestamp",width:180,render:t=>x(t).format("YYYY-MM-DD HH:mm:ss")},{title:"用户",key:"user",width:150,render:(t,a)=>e.jsxs(p,{children:[e.jsx(g,{color:h(a.userRole).color,children:h(a.userRole).text}),a.userName]})},{title:"操作",dataIndex:"action",key:"action",width:80,render:t=>e.jsx(g,{color:m(t).color,children:m(t).text})},{title:"模块",dataIndex:"module",key:"module",width:100},{title:"描述",dataIndex:"description",key:"description"},{title:"变更详情",key:"changes",width:200,render:(t,a)=>a.oldValue&&a.newValue?e.jsxs("span",{children:[e.jsx("span",{className:"line-through text-gray-400",children:a.oldValue}),e.jsx("span",{className:"mx-1",children:"→"}),e.jsx("span",{className:"text-blue-500",children:a.newValue})]}):"-"}],k=()=>{c(),Y.success("日志已清空")};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"操作日志"}),e.jsxs(p,{children:[e.jsx(j,{icon:e.jsx(z,{}),onClick:()=>window.location.reload(),children:"刷新"}),e.jsx(_,{title:"确定清空所有日志？",onConfirm:k,children:e.jsx(j,{icon:e.jsx(D,{}),danger:!0,children:"清空日志"})})]})]}),e.jsxs(P,{gutter:16,className:"mb-4",children:[e.jsx(r,{span:6,children:e.jsx(o,{children:e.jsx(i,{title:"总日志数",value:l.length})})}),e.jsx(r,{span:6,children:e.jsx(o,{children:e.jsx(i,{title:"今日操作",value:R})})}),e.jsx(r,{span:6,children:e.jsx(o,{children:e.jsx(i,{title:"数据变更",value:C,valueStyle:{color:"#1890ff"}})})}),e.jsx(r,{span:6,children:e.jsx(o,{children:e.jsx(i,{title:"登录次数",value:l.filter(t=>t.action==="login").length,valueStyle:{color:"#52c41a"}})})})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx(F,{placeholder:"搜索描述或用户",prefix:e.jsx(V,{}),value:s,onChange:t=>v(t.target.value),style:{width:200}}),e.jsx(f,{placeholder:"操作类型",allowClear:!0,style:{width:120},value:d,onChange:w,options:[{label:"新增",value:"create"},{label:"修改",value:"update"},{label:"删除",value:"delete"},{label:"登录",value:"login"},{label:"登出",value:"logout"}]}),e.jsx(f,{placeholder:"模块",allowClear:!0,style:{width:120},value:u,onChange:y,options:b.map(t=>({label:t,value:t}))}),e.jsx(B.RangePicker,{})]}),e.jsx(E,{columns:I,dataSource:S,rowKey:"id",pagination:{pageSize:15}})]})]})}export{W as default};
