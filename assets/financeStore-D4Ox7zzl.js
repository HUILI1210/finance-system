import{G as y,a3 as r,s as u}from"./index-Cc0-Jhr3.js";const m=[{id:"1",category:"办公费用",amount:5e4,spent:25e3,month:"2024-01"},{id:"2",category:"人力成本",amount:2e5,spent:145e3,month:"2024-01"},{id:"3",category:"营销费用",amount:8e4,spent:35e3,month:"2024-01"}],g=y()(o=>({records:[],budgets:m,loading:!1,fetchRecords:async t=>{o({loading:!0});try{const{data:e}=await r.getRecords(t),d=e.data.map(a=>({id:a.id,type:a.type,amount:a.amount,category:a.category,description:a.description||"",date:a.date.split("T")[0],createdAt:a.createdAt.split("T")[0],version:a.version}));o({records:d,loading:!1})}catch{o({loading:!1})}},addRecord:async t=>{try{const{data:e}=await r.createRecord({type:t.type,amount:t.amount,category:t.category,description:t.description,date:t.date}),d={id:e.id,type:e.type,amount:e.amount,category:e.category,description:e.description||"",date:e.date.split("T")[0],createdAt:e.createdAt.split("T")[0]};o(a=>({records:[d,...a.records]}))}catch{}},updateRecord:async(t,e)=>{var d,a;try{const c=g.getState().records.find(i=>i.id===t),{data:s}=await r.updateRecord(t,{...e,version:c==null?void 0:c.version});o(i=>({records:i.records.map(n=>{var p;return n.id===t?{...n,...s,date:((p=s.date)==null?void 0:p.split("T")[0])||n.date,version:s.version}:n})}))}catch(c){((a=(d=c.response)==null?void 0:d.data)==null?void 0:a.code)==="VERSION_CONFLICT"&&(u.warning("数据已被其他用户修改，正在刷新..."),g.getState().fetchRecords())}},deleteRecord:async t=>{try{await r.deleteRecord(t),o(e=>({records:e.records.filter(d=>d.id!==t)}))}catch{}},addBudget:t=>o(e=>({budgets:[...e.budgets,t]})),updateBudget:(t,e)=>o(d=>({budgets:d.budgets.map(a=>a.id===t?{...a,...e}:a)}))}));export{g as u};
