import{u as v,r as o,j as t,S as l,B as r,f as k,g as E,h as b,T,i as $,k as B,s as F}from"./index-DvYlsgoa.js";import{d as i}from"./dayjs.min-BfZd7ylZ.js";import{u as N}from"./financeStore-DbLMuwj4.js";import{I as Y,E as D}from"./ImportButton-Cl-cSUi8.js";import{S as M}from"./index-Cew7-v5w.js";import{F as z}from"./Table-7vnEQdqH.js";import{P as L}from"./index-DBQWraj-.js";import"./export-cwhyOQjn.js";const P=["办公费用","人力成本","营销费用","差旅费","其他支出"];function O(){const c=v(),{records:x,deleteRecord:m,addRecord:p,fetchRecords:u,loading:f}=N(),h=x.filter(e=>e.type==="expense");o.useEffect(()=>{u()},[]);const[s,j]=o.useState(""),[n,y]=o.useState(),d=h.filter(e=>{const a=e.description.includes(s)||e.category.includes(s),R=!n||e.category===n;return a&&R}),g=e=>{e.forEach(a=>{a.金额&&a.类别&&p({type:"expense",amount:parseFloat(a.金额)||0,category:a.类别||"其他支出",description:a.描述||"",date:a.日期||i().format("YYYY-MM-DD")})})},I=[{title:"日期",dataIndex:"date"},{title:"类别",dataIndex:"category"},{title:"描述",dataIndex:"description"},{title:"金额",dataIndex:"amount",render:e=>String(e)}],S=e=>{m(e),F.success("删除成功")},C=[{title:"日期",dataIndex:"date",key:"date",sorter:(e,a)=>i(e.date).unix()-i(a.date).unix()},{title:"类别",dataIndex:"category",key:"category",render:e=>t.jsx(T,{color:"red",children:e})},{title:"描述",dataIndex:"description",key:"description"},{title:"金额",dataIndex:"amount",key:"amount",render:e=>`¥${e.toLocaleString()}`,sorter:(e,a)=>e.amount-a.amount},{title:"操作",key:"action",render:(e,a)=>t.jsxs(l,{children:[t.jsx(r,{icon:t.jsx($,{}),size:"small",onClick:()=>c(`/expense/edit/${a.id}`),children:"编辑"}),t.jsx(L,{title:"确定删除？",onConfirm:()=>S(a.id),children:t.jsx(r,{icon:t.jsx(B,{}),size:"small",danger:!0,children:"删除"})})]})}];return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold",children:"支出管理"}),t.jsxs(l,{children:[t.jsx(Y,{onImport:g}),t.jsx(D,{data:d,columns:I,filename:"支出记录"}),t.jsx(r,{type:"primary",icon:t.jsx(k,{}),onClick:()=>c("/expense/create"),children:"新增支出"})]})]}),t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsx(E,{placeholder:"搜索描述或类别",prefix:t.jsx(b,{}),value:s,onChange:e=>j(e.target.value),style:{width:250}}),t.jsx(M,{placeholder:"选择类别",allowClear:!0,style:{width:150},value:n,onChange:y,options:P.map(e=>({label:e,value:e}))})]}),t.jsx(z,{columns:C,dataSource:d,rowKey:"id",loading:f})]})}export{O as default};
