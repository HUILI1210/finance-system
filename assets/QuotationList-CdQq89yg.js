import{r as j,I as U,_ as O,G as nt,H as at,F as s,j as t,B as c,f as st,R as A,C as o,a as g,M as F,g as x,E as it,s as I,T as lt,z as rt,i as ot,a4 as dt,k as ct}from"./index-Cc0-Jhr3.js";import{d as p}from"./dayjs.min-BVNUWGIa.js";import{u as mt}from"./accountsStore-DuMcA17q.js";import{S as N}from"./index-BAFu33Px.js";import{F as l}from"./Table-CWDNoC-e.js";import{S as ut}from"./index-BlAgGAzq.js";import{D as xt}from"./index-D5WML2O3.js";import{T as Y}from"./index-BFN91nfk.js";import{D as h}from"./index-BPzBcVnd.js";import{P as ht}from"./index-4_QrhmQT.js";var pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"},jt=function(d,r){return j.createElement(U,O({},d,{ref:r,icon:pt}))},T=j.forwardRef(jt),gt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"},ft=function(d,r){return j.createElement(U,O({},d,{ref:r,icon:gt}))},yt=j.forwardRef(ft);const It=[{id:"1",quotationNo:"QT202401001",customerId:"1",customerName:"客户A公司",customerContact:"张经理",customerPhone:"13900139001",customerEmail:"a@customer.com",customerAddress:"北京市朝阳区xxx路",title:"软件开发服务报价",items:[{id:"1",name:"需求分析",description:"业务需求调研与分析",unit:"项",quantity:1,unitPrice:5e4,amount:5e4},{id:"2",name:"系统设计",description:"系统架构与UI设计",unit:"项",quantity:1,unitPrice:8e4,amount:8e4},{id:"3",name:"开发实施",description:"前后端开发与测试",unit:"人天",quantity:60,unitPrice:2e3,amount:12e4},{id:"4",name:"部署上线",description:"系统部署与培训",unit:"项",quantity:1,unitPrice:3e4,amount:3e4}],subtotal:28e4,taxRate:6,taxAmount:16800,totalAmount:296800,validUntil:"2024-02-28",terms:`1. 付款方式：合同签订后支付30%，验收后支付70%
2. 项目周期：约3个月
3. 质保期：1年免费维护`,status:"sent",createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"2",quotationNo:"QT202401002",customerId:"2",customerName:"客户B公司",customerContact:"李总",customerPhone:"13900139002",customerEmail:"b@customer.com",customerAddress:"上海市浦东新区xxx路",title:"年度咨询服务报价",items:[{id:"1",name:"管理咨询",description:"企业管理优化咨询",unit:"月",quantity:12,unitPrice:15e3,amount:18e4},{id:"2",name:"培训服务",description:"员工技能培训",unit:"次",quantity:6,unitPrice:5e3,amount:3e4}],subtotal:21e4,taxRate:6,taxAmount:12600,totalAmount:222600,validUntil:"2024-02-15",terms:`1. 按季度付款
2. 服务期限：2024年全年`,status:"accepted",createdAt:"2024-01-10",updatedAt:"2024-01-20"},{id:"3",quotationNo:"QT202401003",customerId:"3",customerName:"客户C公司",customerContact:"王主管",customerPhone:"13900139003",customerEmail:"c@customer.com",customerAddress:"广州市天河区xxx路",title:"设备采购报价",items:[{id:"1",name:"服务器",description:"高性能服务器",unit:"台",quantity:2,unitPrice:35e3,amount:7e4},{id:"2",name:"交换机",description:"企业级交换机",unit:"台",quantity:3,unitPrice:8e3,amount:24e3},{id:"3",name:"安装调试",description:"设备安装与配置",unit:"项",quantity:1,unitPrice:6e3,amount:6e3}],subtotal:1e5,taxRate:13,taxAmount:13e3,totalAmount:113e3,validUntil:"2024-01-31",terms:`1. 款到发货
2. 质保期：3年`,status:"draft",createdAt:"2024-01-22",updatedAt:"2024-01-22"}],St=nt()(at(m=>({quotations:It,addQuotation:d=>m(r=>({quotations:[...r.quotations,d]})),updateQuotation:(d,r)=>m(S=>({quotations:S.quotations.map(f=>f.id===d?{...f,...r}:f)})),deleteQuotation:d=>m(r=>({quotations:r.quotations.filter(S=>S.id!==d)}))}),{name:"quotation-storage"}));function Dt(){const{quotations:m,addQuotation:d,updateQuotation:r,deleteQuotation:S}=St(),{customers:f}=mt(),[E,C]=j.useState(!1),[V,M]=j.useState(!1),[a,P]=j.useState(null),[b,w]=j.useState([]),[y]=s.useForm(),[$]=s.useForm(),H=m.reduce((e,n)=>e+n.totalAmount,0),Q=m.filter(e=>e.status==="accepted").reduce((e,n)=>e+n.totalAmount,0),B=m.filter(e=>e.status==="sent").length,D=e=>{P(e||null),e?(y.setFieldsValue({...e,validUntil:p(e.validUntil)}),w(e.items)):(y.resetFields(),w([])),C(!0)},_=e=>{P(e),M(!0)},K=e=>{const n=f.find(i=>i.id===e);n&&y.setFieldsValue({customerName:n.name,customerContact:n.contact,customerPhone:n.phone,customerEmail:n.email,customerAddress:n.address})},G=()=>{$.validateFields().then(e=>{const n=e.quantity*e.unitPrice,i={...e,id:Date.now().toString(),amount:n};w([...b,i]),$.resetFields()})},W=e=>{w(b.filter(n=>n.id!==e))},k=()=>{const e=b.reduce((u,v)=>u+v.amount,0),n=y.getFieldValue("taxRate")||0,i=Math.round(e*n/100);return{subtotal:e,taxAmount:i,totalAmount:e+i}},J=()=>{y.validateFields().then(e=>{const{subtotal:n,taxAmount:i,totalAmount:u}=k(),v=p().format("YYYY-MM-DD"),L={...e,id:(a==null?void 0:a.id)||Date.now().toString(),quotationNo:(a==null?void 0:a.quotationNo)||`QT${p().format("YYYYMMDD")}${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,items:b,subtotal:n,taxAmount:i,totalAmount:u,validUntil:e.validUntil.format("YYYY-MM-DD"),status:(a==null?void 0:a.status)||"draft",createdAt:(a==null?void 0:a.createdAt)||v,updatedAt:v};a?(r(a.id,L),I.success("更新成功")):(d(L),I.success("创建成功")),C(!1)})},X=e=>{r(e,{status:"sent",updatedAt:p().format("YYYY-MM-DD")}),I.success("报价单已发送")},q=(e,n)=>{r(e,{status:n,updatedAt:p().format("YYYY-MM-DD")}),I.success(n==="accepted"?"客户已接受报价":"客户已拒绝报价")},Z=e=>{const n={...e,id:Date.now().toString(),quotationNo:`QT${p().format("YYYYMMDD")}${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,status:"draft",createdAt:p().format("YYYY-MM-DD"),updatedAt:p().format("YYYY-MM-DD")};d(n),I.success("报价单已复制")},tt=e=>{S(e),I.success("删除成功")},z=e=>{const n=`
      <html>
      <head>
        <title>报价单 - ${e.quotationNo}</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 40px; }
          h1 { text-align: center; }
          table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
          th { background: #f5f5f5; }
          .info { margin: 20px 0; }
          .total { text-align: right; font-size: 18px; font-weight: bold; }
          .terms { margin-top: 30px; white-space: pre-line; }
        </style>
      </head>
      <body>
        <h1>报价单</h1>
        <div class="info">
          <p><strong>报价单号：</strong>${e.quotationNo}</p>
          <p><strong>客户名称：</strong>${e.customerName}</p>
          <p><strong>联系人：</strong>${e.customerContact} | ${e.customerPhone}</p>
          <p><strong>报价标题：</strong>${e.title}</p>
          <p><strong>有效期至：</strong>${e.validUntil}</p>
        </div>
        <table>
          <tr><th>项目名称</th><th>描述</th><th>单位</th><th>数量</th><th>单价</th><th>金额</th></tr>
          ${e.items.map(u=>`<tr><td>${u.name}</td><td>${u.description}</td><td>${u.unit}</td><td>${u.quantity}</td><td>¥${u.unitPrice.toLocaleString()}</td><td>¥${u.amount.toLocaleString()}</td></tr>`).join("")}
        </table>
        <div class="total">
          <p>小计：¥${e.subtotal.toLocaleString()}</p>
          <p>税额(${e.taxRate}%)：¥${e.taxAmount.toLocaleString()}</p>
          <p>总计：¥${e.totalAmount.toLocaleString()}</p>
        </div>
        <div class="terms"><strong>条款与说明：</strong><br/>${e.terms}</div>
      </body>
      </html>
    `,i=window.open("","_blank");i&&(i.document.write(n),i.document.close(),i.print())},R=e=>{const i={draft:{color:"default",text:"草稿"},sent:{color:"blue",text:"已发送"},accepted:{color:"green",text:"已接受"},rejected:{color:"red",text:"已拒绝"},expired:{color:"orange",text:"已过期"}}[e]||{color:"default",text:e};return t.jsx(lt,{color:i.color,children:i.text})},et=[{title:"报价单号",dataIndex:"quotationNo",key:"quotationNo",width:130},{title:"客户",dataIndex:"customerName",key:"customerName",width:120},{title:"标题",dataIndex:"title",key:"title"},{title:"总金额",dataIndex:"totalAmount",key:"totalAmount",width:120,render:e=>t.jsxs("span",{className:"font-bold",children:["¥",e.toLocaleString()]})},{title:"有效期",dataIndex:"validUntil",key:"validUntil",width:110},{title:"状态",dataIndex:"status",key:"status",width:90,render:e=>R(e)},{title:"操作",key:"action",width:280,render:(e,n)=>t.jsxs(t.Fragment,{children:[t.jsx(c,{icon:t.jsx(rt,{}),size:"small",onClick:()=>_(n),children:"查看"}),t.jsx(c,{icon:t.jsx(T,{}),size:"small",className:"ml-1",onClick:()=>z(n),children:"打印"}),n.status==="draft"&&t.jsxs(t.Fragment,{children:[t.jsx(c,{icon:t.jsx(yt,{}),size:"small",type:"primary",className:"ml-1",onClick:()=>X(n.id),children:"发送"}),t.jsx(c,{icon:t.jsx(ot,{}),size:"small",className:"ml-1",onClick:()=>D(n),children:"编辑"})]}),n.status==="sent"&&t.jsxs(t.Fragment,{children:[t.jsx(c,{size:"small",className:"ml-1",onClick:()=>q(n.id,"accepted"),children:"接受"}),t.jsx(c,{size:"small",danger:!0,className:"ml-1",onClick:()=>q(n.id,"rejected"),children:"拒绝"})]}),t.jsx(c,{icon:t.jsx(dt,{}),size:"small",className:"ml-1",onClick:()=>Z(n),children:"复制"}),n.status==="draft"&&t.jsx(ht,{title:"确定删除?",onConfirm:()=>tt(n.id),children:t.jsx(c,{icon:t.jsx(ct,{}),size:"small",danger:!0,className:"ml-1",children:"删除"})})]})}];return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold",children:"报价管理"}),t.jsx(c,{type:"primary",icon:t.jsx(st,{}),onClick:()=>D(),children:"新建报价单"})]}),t.jsxs(A,{gutter:16,className:"mb-4",children:[t.jsx(o,{span:6,children:t.jsx(g,{children:t.jsx(N,{title:"报价单总数",value:m.length})})}),t.jsx(o,{span:6,children:t.jsx(g,{children:t.jsx(N,{title:"待确认",value:B,valueStyle:{color:"#1890ff"}})})}),t.jsx(o,{span:6,children:t.jsx(g,{children:t.jsx(N,{title:"报价总金额",value:H,prefix:"¥",precision:2})})}),t.jsx(o,{span:6,children:t.jsx(g,{children:t.jsx(N,{title:"已成交金额",value:Q,prefix:"¥",precision:2,valueStyle:{color:"#3f8600"}})})})]}),t.jsx(g,{children:t.jsx(l,{columns:et,dataSource:m,rowKey:"id",scroll:{x:1200}})}),t.jsxs(F,{title:a?"编辑报价单":"新建报价单",open:E,onOk:J,onCancel:()=>C(!1),width:900,children:[t.jsxs(s,{form:y,layout:"vertical",children:[t.jsxs(A,{gutter:16,children:[t.jsx(o,{span:8,children:t.jsx(s.Item,{name:"customerId",label:"选择客户",children:t.jsx(ut,{options:f.map(e=>({label:e.name,value:e.id})),onChange:K,placeholder:"选择已有客户",allowClear:!0})})}),t.jsx(o,{span:8,children:t.jsx(s.Item,{name:"customerName",label:"客户名称",rules:[{required:!0}],children:t.jsx(x,{})})}),t.jsx(o,{span:8,children:t.jsx(s.Item,{name:"customerContact",label:"联系人",rules:[{required:!0}],children:t.jsx(x,{})})})]}),t.jsxs(A,{gutter:16,children:[t.jsx(o,{span:8,children:t.jsx(s.Item,{name:"customerPhone",label:"电话",children:t.jsx(x,{})})}),t.jsx(o,{span:8,children:t.jsx(s.Item,{name:"customerEmail",label:"邮箱",children:t.jsx(x,{})})}),t.jsx(o,{span:8,children:t.jsx(s.Item,{name:"customerAddress",label:"地址",children:t.jsx(x,{})})})]}),t.jsxs(A,{gutter:16,children:[t.jsx(o,{span:12,children:t.jsx(s.Item,{name:"title",label:"报价标题",rules:[{required:!0}],children:t.jsx(x,{placeholder:"如：软件开发服务报价"})})}),t.jsx(o,{span:6,children:t.jsx(s.Item,{name:"validUntil",label:"有效期至",rules:[{required:!0}],children:t.jsx(xt,{className:"w-full"})})}),t.jsx(o,{span:6,children:t.jsx(s.Item,{name:"taxRate",label:"税率(%)",initialValue:6,children:t.jsx(Y,{className:"w-full",min:0,max:100})})})]})]}),t.jsx(it,{children:"报价明细"}),t.jsxs(s,{form:$,layout:"inline",className:"mb-3",children:[t.jsx(s.Item,{name:"name",rules:[{required:!0}],style:{width:120},children:t.jsx(x,{placeholder:"项目名称"})}),t.jsx(s.Item,{name:"description",style:{width:150},children:t.jsx(x,{placeholder:"描述"})}),t.jsx(s.Item,{name:"unit",rules:[{required:!0}],style:{width:80},children:t.jsx(x,{placeholder:"单位"})}),t.jsx(s.Item,{name:"quantity",rules:[{required:!0}],style:{width:80},children:t.jsx(Y,{placeholder:"数量",min:1})}),t.jsx(s.Item,{name:"unitPrice",rules:[{required:!0}],style:{width:100},children:t.jsx(Y,{placeholder:"单价",min:0})}),t.jsx(c,{type:"primary",onClick:G,children:"添加"})]}),t.jsx(l,{size:"small",pagination:!1,dataSource:b,rowKey:"id",columns:[{title:"项目",dataIndex:"name",width:120},{title:"描述",dataIndex:"description"},{title:"单位",dataIndex:"unit",width:60},{title:"数量",dataIndex:"quantity",width:60},{title:"单价",dataIndex:"unitPrice",width:100,render:e=>`¥${e.toLocaleString()}`},{title:"金额",dataIndex:"amount",width:100,render:e=>`¥${e.toLocaleString()}`},{title:"操作",width:60,render:(e,n)=>t.jsx(c,{size:"small",danger:!0,onClick:()=>W(n.id),children:"删除"})}],summary:()=>{const{subtotal:e,taxAmount:n,totalAmount:i}=k();return t.jsxs(t.Fragment,{children:[t.jsxs(l.Summary.Row,{children:[t.jsx(l.Summary.Cell,{index:0,colSpan:5,align:"right",children:t.jsx("strong",{children:"小计"})}),t.jsx(l.Summary.Cell,{index:1,children:t.jsxs("strong",{children:["¥",e.toLocaleString()]})}),t.jsx(l.Summary.Cell,{index:2})]}),t.jsxs(l.Summary.Row,{children:[t.jsx(l.Summary.Cell,{index:0,colSpan:5,align:"right",children:"税额"}),t.jsxs(l.Summary.Cell,{index:1,children:["¥",n.toLocaleString()]}),t.jsx(l.Summary.Cell,{index:2})]}),t.jsxs(l.Summary.Row,{children:[t.jsx(l.Summary.Cell,{index:0,colSpan:5,align:"right",children:t.jsx("strong",{children:"总计"})}),t.jsx(l.Summary.Cell,{index:1,children:t.jsxs("strong",{className:"text-lg text-green-600",children:["¥",i.toLocaleString()]})}),t.jsx(l.Summary.Cell,{index:2})]})]})}}),t.jsx(s.Item,{name:"terms",label:"条款与说明",className:"mt-4",children:t.jsx(x.TextArea,{rows:3,placeholder:"付款方式、交付时间等说明"})})]}),t.jsx(F,{title:"报价单详情",open:V,onCancel:()=>M(!1),footer:null,width:800,children:a&&t.jsxs(t.Fragment,{children:[t.jsxs(h,{bordered:!0,column:2,size:"small",children:[t.jsx(h.Item,{label:"报价单号",children:a.quotationNo}),t.jsx(h.Item,{label:"状态",children:R(a.status)}),t.jsx(h.Item,{label:"客户名称",children:a.customerName}),t.jsx(h.Item,{label:"联系人",children:a.customerContact}),t.jsx(h.Item,{label:"电话",children:a.customerPhone}),t.jsx(h.Item,{label:"邮箱",children:a.customerEmail}),t.jsx(h.Item,{label:"报价标题",span:2,children:a.title}),t.jsx(h.Item,{label:"创建日期",children:a.createdAt}),t.jsx(h.Item,{label:"有效期至",children:a.validUntil})]}),t.jsxs(g,{title:"报价明细",size:"small",className:"mt-4",children:[t.jsx(l,{size:"small",pagination:!1,dataSource:a.items,rowKey:"id",columns:[{title:"项目",dataIndex:"name"},{title:"描述",dataIndex:"description"},{title:"单位",dataIndex:"unit",width:60},{title:"数量",dataIndex:"quantity",width:60},{title:"单价",dataIndex:"unitPrice",render:e=>`¥${e.toLocaleString()}`},{title:"金额",dataIndex:"amount",render:e=>`¥${e.toLocaleString()}`}]}),t.jsxs("div",{className:"mt-4 text-right",children:[t.jsxs("p",{children:["小计：¥",a.subtotal.toLocaleString()]}),t.jsxs("p",{children:["税额(",a.taxRate,"%)：¥",a.taxAmount.toLocaleString()]}),t.jsxs("p",{className:"text-xl font-bold text-green-600",children:["总计：¥",a.totalAmount.toLocaleString()]})]})]}),a.terms&&t.jsx(g,{title:"条款与说明",size:"small",className:"mt-4",children:t.jsx("pre",{className:"whitespace-pre-wrap",children:a.terms})}),t.jsx("div",{className:"mt-4 text-right",children:t.jsx(c,{icon:t.jsx(T,{}),onClick:()=>z(a),children:"打印报价单"})})]})})]})}export{Dt as default};
