import{aJ as M,r as v,F as s,j as e,B as h,f as T,R as A,C as r,a as n,M as D,g as x,s as o,b4 as E,T as P,i as q,k as z}from"./index-Cc0-Jhr3.js";import{S as u}from"./index-BAFu33Px.js";import{F as B}from"./Table-CWDNoC-e.js";import{S as b}from"./index-BlAgGAzq.js";import{S as J}from"./index-B2crc-5Y.js";import{P as L}from"./index-4_QrhmQT.js";function Q(){var S,g;const{users:i,addUser:y,updateUser:p,deleteUser:k,addLog:d}=M(),[w,j]=v.useState(!1),[m,R]=v.useState(null),[c]=s.useForm(),a=(g=(S=JSON.parse(localStorage.getItem("auth-storage")||"{}"))==null?void 0:S.state)==null?void 0:g.user,f=l=>{R(l||null),l?c.setFieldsValue(l):c.resetFields(),j(!0)},C=()=>{c.validateFields().then(l=>{if(m)p(m.id,l),d({userId:(a==null?void 0:a.id)||"",userName:(a==null?void 0:a.name)||"",userRole:(a==null?void 0:a.role)||"admin",action:"update",module:"用户管理",description:`修改用户 ${l.name}`}),o.success("更新成功");else{const t={...l,id:Date.now().toString(),createdAt:new Date().toISOString().split("T")[0]};y(t),E[l.username]="password123",d({userId:(a==null?void 0:a.id)||"",userName:(a==null?void 0:a.name)||"",userRole:(a==null?void 0:a.role)||"admin",action:"create",module:"用户管理",description:`新增用户 ${l.name}`}),o.success("添加成功，默认密码: password123")}j(!1)})},F=l=>{if(l.username==="admin"){o.error("不能删除管理员账号");return}k(l.id),d({userId:(a==null?void 0:a.id)||"",userName:(a==null?void 0:a.name)||"",userRole:(a==null?void 0:a.role)||"admin",action:"delete",module:"用户管理",description:`删除用户 ${l.name}`}),o.success("删除成功")},N=(l,t)=>{p(l.id,{status:t?"active":"inactive"}),d({userId:(a==null?void 0:a.id)||"",userName:(a==null?void 0:a.name)||"",userRole:(a==null?void 0:a.role)||"admin",action:"update",module:"用户管理",description:`${t?"启用":"禁用"}用户 ${l.name}`}),o.success(t?"用户已启用":"用户已禁用")},I=l=>({admin:{color:"red",text:"管理员"},accountant:{color:"blue",text:"财务会计"},viewer:{color:"green",text:"普通用户"}})[l],O=[{title:"用户名",dataIndex:"username",key:"username"},{title:"姓名",dataIndex:"name",key:"name"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"角色",dataIndex:"role",key:"role",render:l=>e.jsx(P,{color:I(l).color,children:I(l).text})},{title:"状态",dataIndex:"status",key:"status",render:(l,t)=>e.jsx(J,{checked:l==="active",onChange:$=>N(t,$),disabled:t.username==="admin"})},{title:"创建时间",dataIndex:"createdAt",key:"createdAt"},{title:"操作",key:"action",render:(l,t)=>e.jsxs(e.Fragment,{children:[e.jsx(h,{icon:e.jsx(q,{}),size:"small",onClick:()=>f(t),children:"编辑"}),t.username!=="admin"&&e.jsx(L,{title:"确定删除?",onConfirm:()=>F(t),children:e.jsx(h,{icon:e.jsx(z,{}),size:"small",danger:!0,className:"ml-1",children:"删除"})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"用户管理"}),e.jsx(h,{type:"primary",icon:e.jsx(T,{}),onClick:()=>f(),children:"新增用户"})]}),e.jsxs(A,{gutter:16,className:"mb-4",children:[e.jsx(r,{span:6,children:e.jsx(n,{children:e.jsx(u,{title:"用户总数",value:i.length})})}),e.jsx(r,{span:6,children:e.jsx(n,{children:e.jsx(u,{title:"管理员",value:i.filter(l=>l.role==="admin").length,valueStyle:{color:"#cf1322"}})})}),e.jsx(r,{span:6,children:e.jsx(n,{children:e.jsx(u,{title:"财务会计",value:i.filter(l=>l.role==="accountant").length,valueStyle:{color:"#1890ff"}})})}),e.jsx(r,{span:6,children:e.jsx(n,{children:e.jsx(u,{title:"普通用户",value:i.filter(l=>l.role==="viewer").length,valueStyle:{color:"#52c41a"}})})})]}),e.jsx(n,{children:e.jsx(B,{columns:O,dataSource:i,rowKey:"id"})}),e.jsx(D,{title:m?"编辑用户":"新增用户",open:w,onOk:C,onCancel:()=>j(!1),children:e.jsxs(s,{form:c,layout:"vertical",children:[e.jsx(s.Item,{name:"username",label:"用户名",rules:[{required:!0}],children:e.jsx(x,{disabled:!!m})}),e.jsx(s.Item,{name:"name",label:"姓名",rules:[{required:!0}],children:e.jsx(x,{})}),e.jsx(s.Item,{name:"email",label:"邮箱",children:e.jsx(x,{})}),e.jsx(s.Item,{name:"phone",label:"手机",children:e.jsx(x,{})}),e.jsx(s.Item,{name:"role",label:"角色",rules:[{required:!0}],children:e.jsx(b,{options:[{label:"管理员",value:"admin"},{label:"财务会计",value:"accountant"},{label:"普通用户",value:"viewer"}]})}),e.jsx(s.Item,{name:"status",label:"状态",initialValue:"active",children:e.jsx(b,{options:[{label:"启用",value:"active"},{label:"禁用",value:"inactive"}]})})]})})]})}export{Q as default};
