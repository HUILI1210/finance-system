import{r as p,F as s,j as e,S,g as n,h as Y,B as x,f as z,M as L,s as y,T as b,y as w,i as _,k as K}from"./index-B1irlVr5.js";import{d as V}from"./dayjs.min-CuWnGRVX.js";import{u as G}from"./salaryStore-tJ1QZuQs.js";import{F as H}from"./Table-WxZSygbk.js";import{S as g}from"./index-CouCZRz8.js";import{T as D}from"./index-DtubzoSF.js";import{D as J}from"./index-B_DoBQcZ.js";import{P as Q}from"./index-CsXvx_N-.js";const U=["技术部","市场部","财务部","人事部","运营部"];function ne(){const{employees:k,addEmployee:F,updateEmployee:v,deleteEmployee:N,salaryFormulas:h,salaryStructures:c,addSalaryStructure:j,updateSalaryStructure:M}=G(),[o,E]=p.useState(""),[T,m]=p.useState(!1),[r,q]=p.useState(null),[d]=s.useForm(),A=k.filter(t=>t.name.includes(o)||t.employeeNo.includes(o)||t.department.includes(o)),f=t=>{if(q(t||null),t){const a=c.find(l=>l.employeeId===t.id);d.setFieldsValue({...t,entryDate:V(t.entryDate),baseSalary:(a==null?void 0:a.baseSalary)||0,positionAllowance:(a==null?void 0:a.positionAllowance)||0})}else d.resetFields();m(!0)},O=()=>{d.validateFields().then(t=>{const{baseSalary:a,positionAllowance:l,salaryFormulaId:u,...B}=t,I={...B,entryDate:t.entryDate.format("YYYY-MM-DD"),salaryFormulaId:u};if(r){v(r.id,I);const i=c.find(P=>P.employeeId===r.id);i?M(i.id,{baseSalary:a,positionAllowance:l}):j({id:Date.now().toString(),employeeId:r.id,baseSalary:a,positionAllowance:l,performanceBonus:0,socialInsurance:Math.round(a*.1),housingFund:Math.round(a*.08),effectiveDate:new Date().toISOString().split("T")[0]}),y.success("更新成功")}else{const i=Date.now().toString();F({...I,id:i,status:"active"}),j({id:(Date.now()+1).toString(),employeeId:i,baseSalary:a,positionAllowance:l,performanceBonus:0,socialInsurance:Math.round(a*.1),housingFund:Math.round(a*.08),effectiveDate:new Date().toISOString().split("T")[0]}),y.success("添加成功")}m(!1)})},$=t=>{if(!t)return"未设置";const a=h.find(l=>l.id===t);return(a==null?void 0:a.name)||"未知"},C=t=>{N(t),y.success("删除成功")},R=[{title:"工号",dataIndex:"employeeNo",key:"employeeNo",width:90},{title:"姓名",dataIndex:"name",key:"name",width:80},{title:"部门",dataIndex:"department",key:"department",width:90},{title:"职位",dataIndex:"position",key:"position",width:100},{title:"工资公式",dataIndex:"salaryFormulaId",key:"salaryFormulaId",width:120,render:t=>e.jsx(b,{color:t?"blue":"default",children:$(t)})},{title:"基本工资",key:"baseSalary",width:100,render:(t,a)=>{const l=c.find(u=>u.employeeId===a.id);return l?`¥${l.baseSalary.toLocaleString()}`:"-"}},{title:"入职日期",dataIndex:"entryDate",key:"entryDate",width:110},{title:"状态",dataIndex:"status",key:"status",width:70,render:t=>e.jsx(b,{color:t==="active"?"green":"red",children:t==="active"?"在职":"离职"})},{title:"操作",key:"action",width:150,render:(t,a)=>e.jsxs(S,{children:[e.jsx(w,{action:"update",children:e.jsx(x,{icon:e.jsx(_,{}),size:"small",onClick:()=>f(a),children:"编辑"})}),e.jsx(w,{action:"delete",children:e.jsx(Q,{title:"确定删除?",onConfirm:()=>C(a.id),children:e.jsx(x,{icon:e.jsx(K,{}),size:"small",danger:!0,children:"删除"})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"员工档案"}),e.jsxs(S,{children:[e.jsx(n,{placeholder:"搜索姓名/工号/部门",prefix:e.jsx(Y,{}),value:o,onChange:t=>E(t.target.value),style:{width:200}}),e.jsx(x,{type:"primary",icon:e.jsx(z,{}),onClick:()=>f(),children:"添加员工"})]})]}),e.jsx(H,{columns:R,dataSource:A,rowKey:"id",scroll:{x:1e3}}),e.jsx(L,{title:r?"编辑员工":"添加员工",open:T,onOk:O,onCancel:()=>m(!1),width:600,children:e.jsx(s,{form:d,layout:"vertical",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(s.Item,{name:"employeeNo",label:"工号",rules:[{required:!0}],children:e.jsx(n,{})}),e.jsx(s.Item,{name:"name",label:"姓名",rules:[{required:!0}],children:e.jsx(n,{})}),e.jsx(s.Item,{name:"department",label:"部门",rules:[{required:!0}],children:e.jsx(g,{options:U.map(t=>({label:t,value:t}))})}),e.jsx(s.Item,{name:"position",label:"职位",rules:[{required:!0}],children:e.jsx(n,{})}),e.jsx(s.Item,{name:"salaryFormulaId",label:"工资公式",rules:[{required:!0,message:"请选择工资公式"}],children:e.jsx(g,{placeholder:"选择工资计算方式",options:h.filter(t=>t.isActive).map(t=>({label:`${t.name} (${t.type==="fixed"?"固定月薪":t.type==="hourly"?"计时":t.type==="piece"?"计件":t.type==="commission"?"提成":"混合"})`,value:t.id}))})}),e.jsx(s.Item,{name:"baseSalary",label:"基本工资",rules:[{required:!0}],children:e.jsx(D,{className:"w-full",min:0,prefix:"¥"})}),e.jsx(s.Item,{name:"positionAllowance",label:"岗位津贴",children:e.jsx(D,{className:"w-full",min:0,prefix:"¥"})}),e.jsx(s.Item,{name:"entryDate",label:"入职日期",rules:[{required:!0}],children:e.jsx(J,{className:"w-full"})}),e.jsx(s.Item,{name:"phone",label:"手机",rules:[{required:!0}],children:e.jsx(n,{})}),e.jsx(s.Item,{name:"email",label:"邮箱",children:e.jsx(n,{})}),e.jsx(s.Item,{name:"bankName",label:"开户行",children:e.jsx(n,{})}),e.jsx(s.Item,{name:"bankAccount",label:"银行账号",className:"col-span-2",children:e.jsx(n,{})})]})})})]})}export{ne as default};
