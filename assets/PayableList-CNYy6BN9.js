import{r as m,F as s,j as e,B as g,f as L,R as _,C as p,a as i,T as I,M as S,g as b,s as D}from"./index-DvYlsgoa.js";import{d as x}from"./dayjs.min-BfZd7ylZ.js";import{u as z}from"./accountsStore-DK9nsyQx.js";import{S as f}from"./index-BHsiPuWj.js";import{F as A}from"./Table-7vnEQdqH.js";import{S as B}from"./index-Cew7-v5w.js";import{T as N}from"./index-CRZzFNA5.js";import{D as E}from"./index-BQmgfC5F.js";import{R as K}from"./DollarOutlined-DhTCPQ8B.js";function ee(){const{payables:l,suppliers:j,addPayable:v,updatePayable:k}=z(),[w,o]=m.useState(!1),[M,d]=m.useState(!1),[r,F]=m.useState(null),[u]=s.useForm(),[c]=s.useForm(),h=l.reduce((t,a)=>t+a.amount,0),y=l.reduce((t,a)=>t+a.paidAmount,0),P=()=>{u.resetFields(),o(!0)},T=t=>{F(t),c.setFieldsValue({amount:t.amount-t.paidAmount}),d(!0)},C=()=>{u.validateFields().then(t=>{const a=j.find(n=>n.id===t.supplierId);v({...t,id:Date.now().toString(),supplierName:(a==null?void 0:a.name)||"",dueDate:t.dueDate.format("YYYY-MM-DD"),paidAmount:0,status:"pending",createdAt:x().format("YYYY-MM-DD")}),D.success("添加成功"),o(!1)})},Y=()=>{c.validateFields().then(t=>{if(!r)return;const a=r.paidAmount+t.amount,n=a>=r.amount?"paid":"partial";k(r.id,{paidAmount:a,status:n}),D.success("付款成功"),d(!1)})},O=t=>({pending:"blue",partial:"orange",paid:"green",overdue:"red"})[t]||"default",R=t=>({pending:"待付款",partial:"部分付款",paid:"已付款",overdue:"已逾期"})[t]||t,$=[{title:"发票号",dataIndex:"invoiceNo",key:"invoiceNo"},{title:"供应商",dataIndex:"supplierName",key:"supplierName"},{title:"应付金额",dataIndex:"amount",key:"amount",render:t=>`¥${t.toLocaleString()}`},{title:"已付金额",dataIndex:"paidAmount",key:"paidAmount",render:t=>`¥${t.toLocaleString()}`},{title:"待付金额",key:"remaining",render:(t,a)=>e.jsxs("span",{className:"text-orange-600",children:["¥",(a.amount-a.paidAmount).toLocaleString()]})},{title:"到期日",dataIndex:"dueDate",key:"dueDate"},{title:"状态",dataIndex:"status",key:"status",render:t=>e.jsx(I,{color:O(t),children:R(t)})},{title:"操作",key:"action",render:(t,a)=>a.status!=="paid"&&e.jsx(g,{icon:e.jsx(K,{}),size:"small",type:"primary",onClick:()=>T(a),children:"付款"})}],q=l.filter(t=>t.status!=="paid").sort((t,a)=>new Date(t.dueDate).getTime()-new Date(a.dueDate).getTime()).slice(0,5);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"应付账款"}),e.jsx(g,{type:"primary",icon:e.jsx(L,{}),onClick:P,children:"新增应付"})]}),e.jsxs(_,{gutter:16,className:"mb-4",children:[e.jsx(p,{span:8,children:e.jsx(i,{children:e.jsx(f,{title:"应付总额",value:h,prefix:"¥",precision:2})})}),e.jsx(p,{span:8,children:e.jsx(i,{children:e.jsx(f,{title:"已付金额",value:y,prefix:"¥",precision:2,valueStyle:{color:"#3f8600"}})})}),e.jsx(p,{span:8,children:e.jsx(i,{children:e.jsx(f,{title:"待付金额",value:h-y,prefix:"¥",precision:2,valueStyle:{color:"#fa8c16"}})})})]}),e.jsx(i,{title:"付款计划（按到期日）",className:"mb-4",children:e.jsx(A,{columns:[{title:"供应商",dataIndex:"supplierName"},{title:"待付金额",render:(t,a)=>`¥${(a.amount-a.paidAmount).toLocaleString()}`},{title:"到期日",dataIndex:"dueDate"},{title:"剩余天数",render:(t,a)=>{const n=x(a.dueDate).diff(x(),"day");return e.jsx(I,{color:n<0?"red":n<7?"orange":"green",children:n<0?`逾期${-n}天`:`${n}天`})}}],dataSource:q,rowKey:"id",pagination:!1,size:"small"})}),e.jsx(i,{title:"应付明细",children:e.jsx(A,{columns:$,dataSource:l,rowKey:"id"})}),e.jsx(S,{title:"新增应付",open:w,onOk:C,onCancel:()=>o(!1),children:e.jsxs(s,{form:u,layout:"vertical",children:[e.jsx(s.Item,{name:"supplierId",label:"供应商",rules:[{required:!0}],children:e.jsx(B,{options:j.map(t=>({label:t.name,value:t.id}))})}),e.jsx(s.Item,{name:"invoiceNo",label:"发票号",rules:[{required:!0}],children:e.jsx(b,{})}),e.jsx(s.Item,{name:"amount",label:"金额",rules:[{required:!0}],children:e.jsx(N,{className:"w-full",prefix:"¥",precision:2})}),e.jsx(s.Item,{name:"dueDate",label:"到期日",rules:[{required:!0}],children:e.jsx(E,{className:"w-full"})}),e.jsx(s.Item,{name:"description",label:"描述",children:e.jsx(b.TextArea,{})})]})}),e.jsx(S,{title:"付款",open:M,onOk:Y,onCancel:()=>d(!1),children:e.jsx(s,{form:c,layout:"vertical",children:e.jsx(s.Item,{name:"amount",label:"付款金额",rules:[{required:!0}],children:e.jsx(N,{className:"w-full",prefix:"¥",precision:2,min:0,max:r?r.amount-r.paidAmount:0})})})})]})}export{ee as default};
