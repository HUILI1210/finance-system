import{r as u,F as r,j as e,B as g,f as B,R as N,C as m,a as x,M as w,g as C,s as y,P as R,i as L}from"./index-B1irlVr5.js";import{u as O}from"./financeStore-Cx6ve21G.js";import{S as p}from"./index-DTABTL4s.js";import{F as q}from"./Table-WxZSygbk.js";import{S as E}from"./index-CouCZRz8.js";import{T}from"./index-DtubzoSF.js";const _=["办公费用","人力成本","营销费用","差旅费","研发费用"];function K(){const{budgets:l,records:h,addBudget:S,updateBudget:I}=O(),[k,i]=u.useState(!1),[o,F]=u.useState(null),[n]=r.useForm(),j=u.useMemo(()=>l.map(t=>{const s=h.filter(a=>a.type==="expense"&&a.category===t.category&&a.date.startsWith(t.month)).reduce((a,M)=>a+M.amount,0);return{...t,actualSpent:s}}),[l,h]),c=l.reduce((t,s)=>t+s.amount,0),d=j.reduce((t,s)=>t+s.actualSpent,0),f=t=>{F(t||null),t?n.setFieldsValue(t):n.resetFields(),i(!0)},v=()=>{n.validateFields().then(t=>{o?(I(o.id,t),y.success("更新成功")):(S({...t,id:Date.now().toString(),spent:0}),y.success("添加成功")),i(!1),n.resetFields()})},b=[{title:"类别",dataIndex:"category",key:"category"},{title:"预算月份",dataIndex:"month",key:"month"},{title:"预算金额",dataIndex:"amount",key:"amount",render:t=>`¥${t.toLocaleString()}`},{title:"实际支出",dataIndex:"actualSpent",key:"actualSpent",render:t=>e.jsxs("span",{className:"text-red-600",children:["¥",t.toLocaleString()]})},{title:"剩余",key:"remaining",render:(t,s)=>{const a=s.amount-s.actualSpent;return e.jsxs("span",{className:a<0?"text-red-600 font-bold":"text-green-600",children:["¥",a.toLocaleString()]})}},{title:"使用进度",key:"progress",render:(t,s)=>{const a=Math.min(100,Math.round(s.actualSpent/s.amount*100));return e.jsx(R,{percent:a,status:a>100||a>80?"exception":"active",size:"small"})}},{title:"操作",key:"action",render:(t,s)=>e.jsx(g,{icon:e.jsx(L,{}),size:"small",onClick:()=>f(s),children:"编辑"})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"预算管理"}),e.jsx(g,{type:"primary",icon:e.jsx(B,{}),onClick:()=>f(),children:"新增预算"})]}),e.jsxs(N,{gutter:16,className:"mb-4",children:[e.jsx(m,{span:8,children:e.jsx(x,{children:e.jsx(p,{title:"预算总额",value:c,prefix:"¥",precision:2})})}),e.jsx(m,{span:8,children:e.jsx(x,{children:e.jsx(p,{title:"实际支出",value:d,prefix:"¥",precision:2,valueStyle:{color:"#cf1322"}})})}),e.jsx(m,{span:8,children:e.jsx(x,{children:e.jsx(p,{title:"预算使用率",value:(d/c*100).toFixed(1),suffix:"%",valueStyle:{color:d/c>.8?"#cf1322":"#3f8600"}})})})]}),e.jsx(q,{columns:b,dataSource:j,rowKey:"id"}),e.jsx(w,{title:o?"编辑预算":"新增预算",open:k,onOk:v,onCancel:()=>i(!1),children:e.jsxs(r,{form:n,layout:"vertical",children:[e.jsx(r.Item,{name:"category",label:"类别",rules:[{required:!0}],children:e.jsx(E,{options:_.map(t=>({label:t,value:t}))})}),e.jsx(r.Item,{name:"month",label:"预算月份",rules:[{required:!0}],children:e.jsx(C,{placeholder:"格式：2024-01"})}),e.jsx(r.Item,{name:"amount",label:"预算金额",rules:[{required:!0}],children:e.jsx(T,{className:"w-full",min:0,precision:2,prefix:"¥"})}),e.jsx("p",{className:"text-gray-500 text-sm",children:"提示：实际支出金额会自动根据支出记录计算"})]})})]})}export{K as default};
