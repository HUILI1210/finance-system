import{u as v,r as n,j as t,S as l,B as r,f as k,g as b,h as E,T,i as $,k as B,s as F}from"./index-DvYlsgoa.js";import{d as i}from"./dayjs.min-BfZd7ylZ.js";import{u as N}from"./financeStore-DbLMuwj4.js";import{I as Y,E as D}from"./ImportButton-Cl-cSUi8.js";import{S as M}from"./index-Cew7-v5w.js";import{F as z}from"./Table-7vnEQdqH.js";import{P as L}from"./index-DBQWraj-.js";import"./export-cwhyOQjn.js";const P=["销售收入","服务收入","投资收益","其他收入"];function O(){const c=v(),{records:m,deleteRecord:x,addRecord:u,fetchRecords:p,loading:f}=N(),h=m.filter(e=>e.type==="income");n.useEffect(()=>{p()},[]);const[s,j]=n.useState(""),[o,g]=n.useState(),d=h.filter(e=>{const a=e.description.includes(s)||e.category.includes(s),R=!o||e.category===o;return a&&R}),y=e=>{e.forEach(a=>{a.金额&&a.类别&&u({type:"income",amount:parseFloat(a.金额)||0,category:a.类别||"其他收入",description:a.描述||"",date:a.日期||i().format("YYYY-MM-DD")})})},I=[{title:"日期",dataIndex:"date"},{title:"类别",dataIndex:"category"},{title:"描述",dataIndex:"description"},{title:"金额",dataIndex:"amount",render:e=>String(e)}],S=e=>{x(e),F.success("删除成功")},C=[{title:"日期",dataIndex:"date",key:"date",sorter:(e,a)=>i(e.date).unix()-i(a.date).unix()},{title:"类别",dataIndex:"category",key:"category",render:e=>t.jsx(T,{color:"green",children:e})},{title:"描述",dataIndex:"description",key:"description"},{title:"金额",dataIndex:"amount",key:"amount",render:e=>`¥${e.toLocaleString()}`,sorter:(e,a)=>e.amount-a.amount},{title:"操作",key:"action",render:(e,a)=>t.jsxs(l,{children:[t.jsx(r,{icon:t.jsx($,{}),size:"small",onClick:()=>c(`/income/edit/${a.id}`),children:"编辑"}),t.jsx(L,{title:"确定删除？",onConfirm:()=>S(a.id),children:t.jsx(r,{icon:t.jsx(B,{}),size:"small",danger:!0,children:"删除"})})]})}];return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold",children:"收入管理"}),t.jsxs(l,{children:[t.jsx(Y,{onImport:y}),t.jsx(D,{data:d,columns:I,filename:"收入记录"}),t.jsx(r,{type:"primary",icon:t.jsx(k,{}),onClick:()=>c("/income/create"),children:"新增收入"})]})]}),t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsx(b,{placeholder:"搜索描述或类别",prefix:t.jsx(E,{}),value:s,onChange:e=>j(e.target.value),style:{width:250}}),t.jsx(M,{placeholder:"选择类别",allowClear:!0,style:{width:150},value:o,onChange:g,options:P.map(e=>({label:e,value:e}))})]}),t.jsx(z,{columns:C,dataSource:d,rowKey:"id",loading:f})]})}export{O as default};
