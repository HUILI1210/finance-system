import{G as W,H as Z,r as D,F as n,j as e,B as d,f as ee,R,C as c,a as m,M as z,g as v,s as u,T as te,z as ae,y as $,A as se,K as ne,i as re,k as le}from"./index-B1irlVr5.js";import{d as f}from"./dayjs.min-CuWnGRVX.js";import{u as ie}from"./financeStore-Cx6ve21G.js";import{S as w}from"./index-DTABTL4s.js";import{F as h}from"./Table-WxZSygbk.js";import{D as E}from"./index-B_DoBQcZ.js";import{S as q}from"./index-CouCZRz8.js";import{T as oe}from"./index-DtubzoSF.js";import{D as r}from"./index-vBZKdVps.js";import{L as P}from"./index-Lnb20ynl.js";import{P as de}from"./index-CsXvx_N-.js";const ce=[{id:"1",reportNo:"BX202401001",applicant:"张三",department:"技术部",category:"差旅费",amount:3500,items:[{id:"1",category:"交通费",amount:1200,date:"2024-01-15",description:"北京-上海机票"},{id:"2",category:"住宿费",amount:1800,date:"2024-01-15",description:"酒店住宿2晚"},{id:"3",category:"餐饮费",amount:500,date:"2024-01-16",description:"出差期间餐费"}],applyDate:"2024-01-18",status:"approved",approver:"李经理",approveDate:"2024-01-19",description:"上海客户拜访"},{id:"2",reportNo:"BX202401002",applicant:"李四",department:"市场部",category:"招待费",amount:2800,items:[{id:"1",category:"餐饮费",amount:1800,date:"2024-01-20",description:"客户晚宴"},{id:"2",category:"礼品费",amount:1e3,date:"2024-01-20",description:"客户礼品"}],applyDate:"2024-01-21",status:"pending",description:"客户A公司商务接待"},{id:"3",reportNo:"BX202401003",applicant:"王五",department:"财务部",category:"办公费",amount:680,items:[{id:"1",category:"办公用品",amount:380,date:"2024-01-22",description:"打印纸、文具"},{id:"2",category:"快递费",amount:300,date:"2024-01-23",description:"文件快递"}],applyDate:"2024-01-24",status:"paid",approver:"李经理",approveDate:"2024-01-24",paidDate:"2024-01-25",description:"日常办公费用"}],pe=W()(Z(i=>({expenseReports:ce,addExpenseReport:p=>i(l=>({expenseReports:[...l.expenseReports,p]})),updateExpenseReport:(p,l)=>i(j=>({expenseReports:j.expenseReports.map(y=>y.id===p?{...y,...l}:y)})),deleteExpenseReport:p=>i(l=>({expenseReports:l.expenseReports.filter(j=>j.id!==p)}))}),{name:"expense-storage"})),me=["差旅费","招待费","办公费","交通费","培训费","其他"],xe=["交通费","住宿费","餐饮费","礼品费","办公用品","快递费","其他"];function Se(){const{expenseReports:i,addExpenseReport:p,updateExpenseReport:l,deleteExpenseReport:j}=pe(),{addRecord:y}=ie(),[B,b]=D.useState(!1),[O,Y]=D.useState(!1),[s,k]=D.useState(null),[x,g]=D.useState([]),[I]=n.useForm(),[S]=n.useForm(),M=i.filter(t=>t.status==="pending"),T=M.reduce((t,a)=>t+a.amount,0),A=i.filter(t=>t.status==="paid").reduce((t,a)=>t+a.amount,0),C=t=>{k(t||null),t?(I.setFieldsValue({...t,applyDate:f(t.applyDate)}),g(t.items)):(I.resetFields(),g([])),b(!0)},L=t=>{k(t),Y(!0)},X=()=>{S.validateFields().then(t=>{const a={...t,id:Date.now().toString(),date:t.date.format("YYYY-MM-DD")};g([...x,a]),S.resetFields()})},K=t=>{g(x.filter(a=>a.id!==t))},_=()=>{I.validateFields().then(t=>{const a=x.reduce((N,U)=>N+U.amount,0),o={...t,id:(s==null?void 0:s.id)||Date.now().toString(),reportNo:(s==null?void 0:s.reportNo)||`BX${f().format("YYYYMMDD")}${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,applyDate:t.applyDate.format("YYYY-MM-DD"),items:x,amount:a,status:(s==null?void 0:s.status)||"pending"};s?(l(s.id,o),u.success("更新成功")):(p(o),u.success("提交成功")),b(!1)})},G=t=>{l(t,{status:"approved",approver:"管理员",approveDate:f().format("YYYY-MM-DD")}),u.success("审批通过")},H=t=>{l(t,{status:"rejected",approver:"管理员",approveDate:f().format("YYYY-MM-DD")}),u.warning("已驳回")},V=t=>{const a=i.find(N=>N.id===t);if(!a)return;const o=f().format("YYYY-MM-DD");l(t,{status:"paid",paidDate:o}),y({id:`expense-report-${t}-${Date.now()}`,type:"expense",amount:a.amount,category:a.category,description:`费用报销 - ${a.applicant} (${a.reportNo})`,date:o,createdAt:o}),u.success("已付款，已自动生成支出记录")},J=t=>{j(t),u.success("删除成功")},F=t=>{const o={draft:{color:"default",text:"草稿"},pending:{color:"orange",text:"待审批"},approved:{color:"blue",text:"已批准"},rejected:{color:"red",text:"已驳回"},paid:{color:"green",text:"已付款"}}[t]||{color:"default",text:t};return e.jsx(te,{color:o.color,children:o.text})},Q=[{title:"报销单号",dataIndex:"reportNo",key:"reportNo",width:140},{title:"申请人",dataIndex:"applicant",key:"applicant",width:80},{title:"部门",dataIndex:"department",key:"department",width:80},{title:"类别",dataIndex:"category",key:"category",width:80},{title:"金额",dataIndex:"amount",key:"amount",width:100,render:t=>`¥${t.toLocaleString()}`},{title:"申请日期",dataIndex:"applyDate",key:"applyDate",width:110},{title:"状态",dataIndex:"status",key:"status",width:90,render:t=>F(t)},{title:"操作",key:"action",width:250,render:(t,a)=>e.jsxs(e.Fragment,{children:[e.jsx(d,{icon:e.jsx(ae,{}),size:"small",onClick:()=>L(a),children:"详情"}),a.status==="pending"&&e.jsxs($,{action:"update",children:[e.jsx(d,{icon:e.jsx(se,{}),size:"small",type:"primary",className:"ml-1",onClick:()=>G(a.id),children:"通过"}),e.jsx(d,{icon:e.jsx(ne,{}),size:"small",danger:!0,className:"ml-1",onClick:()=>H(a.id),children:"驳回"})]}),a.status==="approved"&&e.jsx($,{action:"update",children:e.jsx(d,{size:"small",type:"primary",className:"ml-1",onClick:()=>V(a.id),children:"付款"})}),(a.status==="draft"||a.status==="rejected")&&e.jsxs(e.Fragment,{children:[e.jsx(d,{icon:e.jsx(re,{}),size:"small",className:"ml-1",onClick:()=>C(a),children:"编辑"}),e.jsx(de,{title:"确定删除?",onConfirm:()=>J(a.id),children:e.jsx(d,{icon:e.jsx(le,{}),size:"small",danger:!0,className:"ml-1",children:"删除"})})]})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"费用报销"}),e.jsx(d,{type:"primary",icon:e.jsx(ee,{}),onClick:()=>C(),children:"新增报销"})]}),e.jsxs(R,{gutter:16,className:"mb-4",children:[e.jsx(c,{span:6,children:e.jsx(m,{children:e.jsx(w,{title:"报销总数",value:i.length})})}),e.jsx(c,{span:6,children:e.jsx(m,{children:e.jsx(w,{title:"待审批",value:M.length,valueStyle:{color:"#fa8c16"}})})}),e.jsx(c,{span:6,children:e.jsx(m,{children:e.jsx(w,{title:"待审批金额",value:T,prefix:"¥",precision:2,valueStyle:{color:"#fa8c16"}})})}),e.jsx(c,{span:6,children:e.jsx(m,{children:e.jsx(w,{title:"已报销金额",value:A,prefix:"¥",precision:2,valueStyle:{color:"#3f8600"}})})})]}),e.jsx(m,{children:e.jsx(h,{columns:Q,dataSource:i,rowKey:"id",scroll:{x:1100}})}),e.jsxs(z,{title:s?"编辑报销单":"新增报销单",open:B,onOk:_,onCancel:()=>b(!1),width:700,children:[e.jsxs(n,{form:I,layout:"vertical",children:[e.jsxs(R,{gutter:16,children:[e.jsx(c,{span:8,children:e.jsx(n.Item,{name:"applicant",label:"申请人",rules:[{required:!0}],children:e.jsx(v,{})})}),e.jsx(c,{span:8,children:e.jsx(n.Item,{name:"department",label:"部门",rules:[{required:!0}],children:e.jsx(v,{})})}),e.jsx(c,{span:8,children:e.jsx(n.Item,{name:"applyDate",label:"申请日期",rules:[{required:!0}],children:e.jsx(E,{className:"w-full"})})})]}),e.jsxs(R,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(n.Item,{name:"category",label:"报销类别",rules:[{required:!0}],children:e.jsx(q,{options:me.map(t=>({label:t,value:t}))})})}),e.jsx(c,{span:12,children:e.jsx(n.Item,{name:"description",label:"事由",children:e.jsx(v,{})})})]})]}),e.jsxs(m,{title:"费用明细",size:"small",className:"mt-4",children:[e.jsxs(n,{form:S,layout:"inline",className:"mb-2",children:[e.jsx(n.Item,{name:"category",rules:[{required:!0}],style:{width:120},children:e.jsx(q,{placeholder:"类别",options:xe.map(t=>({label:t,value:t}))})}),e.jsx(n.Item,{name:"amount",rules:[{required:!0}],style:{width:100},children:e.jsx(oe,{placeholder:"金额",prefix:"¥"})}),e.jsx(n.Item,{name:"date",rules:[{required:!0}],children:e.jsx(E,{placeholder:"日期"})}),e.jsx(n.Item,{name:"description",style:{width:150},children:e.jsx(v,{placeholder:"描述"})}),e.jsx(d,{type:"primary",onClick:X,children:"添加"})]}),e.jsx(h,{size:"small",pagination:!1,dataSource:x,rowKey:"id",columns:[{title:"类别",dataIndex:"category",width:80},{title:"金额",dataIndex:"amount",width:80,render:t=>`¥${t}`},{title:"日期",dataIndex:"date",width:100},{title:"描述",dataIndex:"description"},{title:"操作",width:60,render:(t,a)=>e.jsx(d,{size:"small",danger:!0,onClick:()=>K(a.id),children:"删除"})}],summary:()=>e.jsxs(h.Summary.Row,{children:[e.jsx(h.Summary.Cell,{index:0,children:e.jsx("strong",{children:"合计"})}),e.jsx(h.Summary.Cell,{index:1,children:e.jsxs("strong",{children:["¥",x.reduce((t,a)=>t+a.amount,0)]})}),e.jsx(h.Summary.Cell,{index:2,colSpan:3})]})})]})]}),e.jsx(z,{title:"报销详情",open:O,onCancel:()=>Y(!1),footer:null,width:650,children:s&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{bordered:!0,column:2,size:"small",children:[e.jsx(r.Item,{label:"报销单号",children:s.reportNo}),e.jsx(r.Item,{label:"状态",children:F(s.status)}),e.jsx(r.Item,{label:"申请人",children:s.applicant}),e.jsx(r.Item,{label:"部门",children:s.department}),e.jsx(r.Item,{label:"类别",children:s.category}),e.jsx(r.Item,{label:"申请日期",children:s.applyDate}),e.jsx(r.Item,{label:"报销金额",span:2,children:e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["¥",s.amount.toLocaleString()]})}),e.jsx(r.Item,{label:"事由",span:2,children:s.description}),s.approver&&e.jsx(r.Item,{label:"审批人",children:s.approver}),s.approveDate&&e.jsx(r.Item,{label:"审批日期",children:s.approveDate}),s.paidDate&&e.jsx(r.Item,{label:"付款日期",children:s.paidDate})]}),e.jsx(m,{title:"费用明细",size:"small",className:"mt-4",children:e.jsx(P,{size:"small",dataSource:s.items,renderItem:t=>e.jsxs(P.Item,{children:[e.jsxs("span",{children:[t.date," - ",t.category]}),e.jsxs("span",{className:"font-bold",children:["¥",t.amount]}),e.jsx("span",{className:"text-gray-500",children:t.description})]})})})]})})]})}export{Se as default};
